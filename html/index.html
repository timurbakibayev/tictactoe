<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>TicTacToe</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
</head>
<body>
    <h1>TicTacToe</h1>
    <div id="app" class="app">
        <div class="game" style="position:absolute; width: 400px">
            <div class="row">
                <div class="cell" id="a00" onclick="play_cell(0, 0)"></div>
                <div class="cell" id="a01" onclick="play_cell(0, 1)"></div>
                <div class="cell" id="a02" onclick="play_cell(0, 2)"></div>
            </div>
            <div class="row">
                <div class="cell" id="a10" onclick="play_cell(1, 0)"></div>
                <div class="cell" id="a11" onclick="play_cell(1, 1)"></div>
                <div class="cell" id="a12" onclick="play_cell(1, 2)"></div>
            </div>
            <div class="row">
                <div class="cell" id="a20" onclick="play_cell(2, 0)"></div>
                <div class="cell" id="a21" onclick="play_cell(2, 1)"></div>
                <div class="cell" id="a22" onclick="play_cell(2, 2)"></div>
            </div>
            <div style="position: absolute; width: 400px; height: 400px; z-index: -1" id="svg_box">
                <svg viewBox="0 0 100 100"
                    style="position: absolute; height: 100%; width: 100%; top: 0; left: 0; z-index: 1"
                    xmlns="http://www.w3.org/2000/svg"
                     id="svg_lines">
                >

                </svg>
            </div>

        </div>
        <!-- lines -->
    </div>

<script>
    let array = [
        [null, null, null],
        [null, null, null],
        [null, null, null]
    ];
    let current_player = 'x';
    const play_cell = (row, col) => {
        if (array[row][col] !== null) {
            return;
        }
        const cell = document.getElementById('a' + row + col);
        cell.classList.add(current_player);
        array[row][col] = current_player;
        current_player = current_player === 'x' ? 'o' : 'x';
        check_game();
    }

    const drawLine = (x1, y1, x2, y2) => {
        const svg_box = document.getElementById('svg_box');
        svg_box.style.zIndex = 1;

        const svg = document.getElementById('svg_lines');
        const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
        line.setAttribute('x1', x1);
        line.setAttribute('y1', y1);
        line.setAttribute('x2', x2);
        line.setAttribute('y2', y2);
        line.setAttribute('stroke', 'green');
        line.setAttribute('stroke-width', '3');
        line.innerHTML = `
            <animate attributeName="x2" from="${x1}" to="${x2}" begin="indefinite" dur="1s"/>
            <animate attributeName="y2" from="${y1}" to="${y2}" begin="indefinite" dur="1s"/>
        `;
        svg.appendChild(line);
        let elements = document.getElementsByTagName("animate");
        for (var i = 0; i < elements.length; i++) {
            elements[i].beginElement();
        }
    }

    const check_game = () => {
        let who_won = null;
        let draw = true;
        for (let i = 0; i < 3; i++) {
            for (let j = 0; j < 3; j++) {
                if (array[i][j] === null) {
                    draw = false;
                }
            }
        }
        for (let i = 0; i < 3; i++) {
            if (array[i][0] === array[i][1] && array[i][1] === array[i][2] && array[i][0] !== null) {
                console.log(array[i][0] + ' wins');
                who_won = array[i][0];
                drawLine(10, 33/2 + i * 33, 90, 33/2 + i * 33);
            }
            if (array[0][i] === array[1][i] && array[1][i] === array[2][i] && array[0][i] !== null) {
                console.log(array[0][i] + ' wins');
                who_won = array[0][i];
                drawLine(33/2 + i * 33, 10, 33/2 + i * 33, 90);
            }
        }
        if (array[0][0] === array[1][1] && array[1][1] === array[2][2] && array[0][0] !== null) {
            console.log(array[0][0] + ' wins');
            who_won = array[0][0];
            drawLine(10, 10, 90, 90);
        }
        if (array[0][2] === array[1][1] && array[1][1] === array[2][0] && array[0][2] !== null) {
            console.log(array[0][2] + ' wins');
            who_won = array[0][2];
            drawLine(90, 10, 10, 90);
        }
        if (draw) {
            swal("It's a draw!");
        }
        if (who_won) {
            swal("Good job!", `Player ${who_won} wins!`, "success");
        }
    }

    swal("Let the battle for Dune begin now!");
</script>

</body>
</html>